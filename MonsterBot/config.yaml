system:
  timezone: "Asia/Seoul"
  dry_run: true              # 실계좌 전환 전 반드시 true로 2~3일 관찰
  testnet: false             # [Step 2] Mainnet Data for Real Signal Check
  log_level: "INFO"
  safe_mode: true

universe:
  whitelist:
    - "BTC/USDT"
    - "ETH/USDT"
    - "SOL/USDT"
    - "BNB/USDT"
    - "XRP/USDT"
    - "ADA/USDT"
    - "AVAX/USDT"
    - "LINK/USDT"
    - "DOGE/USDT"
    - "1000SHIB/USDT"
    - "1000PEPE/USDT"
    - "WIF/USDT"
    - "SUI/USDT"
    - "SEI/USDT"
    - "APT/USDT"
    - "FET/USDT"
    - "RENDER/USDT"
    - "WLD/USDT"
    - "NEAR/USDT"
  blacklist:
    - "USDC/USDT"
    - "BUSD/USDT"

scanner:
  active: true
  top_k: 3                   # 감시 후보 상위 3개만
  pick_one_per_cycle: true    # 1사이클 1개만 진입 후보
  max_positions: 1            # 스나이퍼는 동시보유 1개 권장
  sector_quota: 1             # 동일 섹터 1개 제한 (있다면)

market_filters:
  # BTC Fuse (절대 방어)
  btc_symbol: "BTC/USDT"
  btc_tf: "5m"
  btc_fuse_drop: -0.01        # 5분봉 -1% 이하 급락이면 신규진입 금지 + 방어모드
  btc_soft_drop: -0.005       # -0.5% 이하면 신중(가중치/스코어 감점)

strategy: # Mapped 'signal' to 'strategy' for compatibility with existing code
  timeframe: "3m" # existing code uses 'timeframe', user said 'tf: 5m' in signal section. I will respect USER 5m if possible, but existing code might be 3m. User config says tf: 5m under signal. I will use 5m.
  # But wait, existing strategy.py might expect 'timeframe' key in strategy.
  # I'll map user's 'signal' settings to 'strategy' block.
  # signal:
  tf: "5m"
  adx_threshold: 25           # [Relaxed] 25 (More Trades)
  bb_len: 30
  bb_std: 2.4                 # [Stage 1] 2.4 (Relaxed from 2.8)
  bb_factor: 2.4              # Compatibility
  rsi_period: 14
  rsi_entry: 32               # [Tight Sniper] 32
  rsi_oversold: 32            # Compatibility
  rsi_overbought: 68          # Compatibility
  vol_spike_mult: 1.7         # [Stage 1] 1.7x (Relaxed from 2.0)
  volume_factor: 1.7          # Compatibility
  confirm_close: true         # 돌파는 '종가 확정 후' 다음 봉에서만 진입
  
  # Pyramiding (Keeping it but disabling if Sniper logic prefers single shot, User didn't specify pyramiding in Final Config, so I will disable or keep conservative)
  # User didn't include pyramiding in the pasted config. I'll disable it to be safe/pure.
  pyramiding:
    active: false

gate:
  enabled: true
  max_trades_per_day: 3       # ✅ [Safety] Haru 3-bal Limit
  min_minutes_between_entries: 120   # [Stage 1] 2h Cooldown
  require_new_setup: true     # 동일 심볼 재진입은 새로운 셋업 발생 시만
  session_filter:
    enabled: true
    # 변동성/유동성 높은 구간 위주 (선물 기준)
    allow_hours_kst: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]

risk:
  risk_per_trade_pct: 0.01    # [Golden Balance] 0.7% -> 1.0% (Standard Risk)
  risk_per_trade: 0.01        # Compatibility
  max_effective_leverage: 3.0
  max_leverage: 3             # Compatibility
  isolated_margin: true
  one_way_mode: true
  min_notional_usdt: 10.0
  max_daily_loss: 0.015       # Compatibility with core code check
  liq_buffer: 0.05

daily_risk:
  max_daily_loss_pct: 0.015   # 1.5% 도달 시 24h 중단
  reset_hour_kst: 0

cost_model:
  commission_roundtrip_pct: 0.08   # 실제보다 보수적으로
  slippage_roundtrip_pct: 0.07     # 합 0.15%로 가혹하게 훈련

exit:
  # SL / TP 세트
  stop_loss_pct: 0.0115            # -1.15%

  # === 3단계 분할 청산 구조 (권장: 40% + 30% + 30%) ===
  tp1:
    enabled: true
    roi: 0.012                     # +1.2%
    qty_ratio: 0.40                # 40% 청산 (수수료 회수 + 멘탈 보호)

  tp2:
    enabled: true
    roi: 0.025                     # +2.5%
    qty_ratio: 0.30                # 30% 청산

  # 잔여 30%는 트레일링으로 큰 추세 포획
  tp3:
    enabled: true
    roi: 0.045                     # +4.5% (최종 목표, 트레일 후 도달 시 전량 청산)

  # TP1 이후: "무료 포지션화" (수수료 커버 포함)
  after_tp1:
    move_sl_to_entry_plus_pct: 0.0015   # entry +0.15%

  # 초기 방어 트레일: 조금만 맞으면 손실 반감
  early_defense:
    enabled: true
    trigger_roi: 0.006             # +0.6% 도달 시
    sl_to_minus_pct: 0.006         # SL을 -0.6%로 당김

  # === ATR 기반 트레일링 (큰 추세 포획기) ===
  trailing:
    enabled: true
    start_roi: 0.025               # +2.5%부터 트레일 시작
    use_atr: true                  # ATR 기반 동적 거리
    atr_mult_small: 1.5            # ROI < 2%: ATR × 1.5
    atr_mult_large: 2.5            # ROI >= 2%: ATR × 2.5
    fallback_dist: 0.015           # ATR 없을 때 고정 1.5%
    step_roi: 0.002                # SL 갱신 최소 간격 0.2%

  time_cut:
    enabled: true
    mode: "candles"            # "minutes" or "candles" - 캔들 기반 권장
    max_hold_minutes: 240      # mode=minutes일 때 (4시간)
    max_candles: 10            # mode=candles일 때 (10캔들 = 5m*10 = 50분)
    min_profit_pct: 0.005      # 이 수익 미달 시에만 Time Cut 적용

telegram:
  token: ""
  chat_id: ""
